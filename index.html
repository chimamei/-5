<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINOv2 图像检索系统 - 图库浏览</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- 样式部分保持不变，这里为节省空间省略 --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background-color: #111827; color: #E5E7EB; min-height: 100vh; }
        body { background-image: radial-gradient(circle at 20% 50%, rgba(96, 165, 250, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%); }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); overflow: hidden; }
        .navbar { background-color: #4A5568; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .logo-icon { background: linear-gradient(135deg, #60A5FA 0%, #A78BFA 100%); width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; }
        .logo-text h1 { font-size: 1.8rem; font-weight: 600; color: #F9FAFB; margin-bottom: 5px; }
        .logo-text .subtitle { font-size: 0.95rem; color: #CBD5E0; opacity: 0.8; }
        .nav-center { flex: 1; text-align: center; }
        .nav-tabs { display: inline-flex; background: rgba(255, 255, 255, 0.1); border-radius: 50px; padding: 5px; }
        .nav-tab { padding: 10px 25px; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; color: #CBD5E0; text-decoration: none; }
        .nav-tab.active { background: white; color: #4A5568; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .nav-tab:hover:not(.active) { background: rgba(255, 255, 255, 0.2); }
        .stats { display: flex; gap: 25px; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 1.4rem; font-weight: 600; color: #F9FAFB; }
        .stat-label { font-size: 0.85rem; color: #CBD5E0; margin-top: 5px; }
        .main-content { padding: 40px; }
        .gallery-section { margin-bottom: 40px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #E5E7EB; }
        .section-title { font-size: 1.6rem; font-weight: 600; color: #111827; display: flex; align-items: center; gap: 10px; }
        .section-title i { color: #60A5FA; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; }
        .gallery-item { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.05); transition: all 0.3s ease; cursor: pointer; }
        .gallery-item:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.12); }
        .gallery-image { width: 100%; height: 180px; object-fit: cover; display: block; }
        .gallery-label { padding: 15px; text-align: center; font-size: 0.9rem; color: #4B5563; background: #F9FAFB; }
        .quick-search-section { background: linear-gradient(135deg, #6366F1 0%, rgba(99, 102, 241, 0.1) 100%); border-radius: 20px; padding: 40px; text-align: center; margin-top: 30px; }
        .quick-search-icon { background: linear-gradient(135deg, #6366F1 0%, #818CF8 100%); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px; color: white; font-size: 2rem; }
        .quick-search-text h2 { font-size: 1.8rem; color: #111827; margin-bottom: 10px; }
        .quick-search-text p { color: #4B5563; margin-bottom: 25px; font-size: 1rem; }
        .search-btn { background: linear-gradient(135deg, #60A5FA 0%, #A78BFA 100%); color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(96, 165, 250, 0.3); text-decoration: none; display: inline-block; padding: 16px 50px; }
        .search-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(52, 211, 153, 0.4); }
        @media (max-width: 768px) { .container { margin: 10px; border-radius: 15px; } .navbar { padding: 15px; flex-direction: column; gap: 15px; } .nav-center { order: 3; width: 100%; margin-top: 10px; } .stats { width: 100%; justify-content: space-around; } .main-content { padding: 20px; } .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; } .quick-search-section { padding: 30px 20px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- 导航栏 -->
        <div class="navbar">
            <div class="nav-left">
                <div class="logo-icon">
                    <i class="fas fa-search"></i>
                </div>
                <div class="logo-text">
                    <h1>DINOv2 图像检索系统</h1>
                    <p class="subtitle">基于深度学习的智能图片搜索</p>
                </div>
            </div>
            
            <div class="nav-center">
                <div class="nav-tabs">
                    <a href="/" class="nav-tab active">
                        <i class="fas fa-images"></i> 图库浏览
                    </a>
                    <a href="/search" class="nav-tab">
                        <i class="fas fa-camera"></i> 图片检索
                    </a>
                </div>
            </div>
            
            <div class="nav-right">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ gallery_images|length if gallery_images else 0 }}</div>
                        <div class="stat-label">示例图片</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- 英雄介绍区域 -->
            <div class="hero-section" style="text-align: center; padding: 30px 0 40px; background: linear-gradient(180deg, #F9FAFB 0%, white 50%);">
                <h1 style="font-size: 2.5rem; font-weight: 800; color: #1F2937; margin-bottom: 15px;">欢迎来到视觉智能世界</h1>
                <p style="font-size: 1.2rem; color: #6B7280; max-width: 700px; margin: 0 auto;">
                    探索我们精心准备的图库，感受 DINOv2 技术如何改变我们对图片的理解方式。在这里，每一张图片背后都隐藏着丰富的语义信息。
                </p>
            </div>

            <!-- 功能简介 -->
            <div class="features-intro" style="margin: 40px 0; text-align: center;">
                <h3 style="font-size: 1.4rem; font-weight: 600; color: #374151; margin-bottom: 15px;">我们的能力</h3>
                <div style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; color: #4B5563;">
                        <i class="fas fa-brain" style="color: #60A5FA;"></i>
                        <span>深度语义理解</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; color: #4B5563;">
                        <i class="fas fa-tachometer-alt" style="color: #34D399;"></i>
                        <span>毫秒级检索速度</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; color: #4B5563;">
                        <i class="fas fa-globe" style="color: #F59E0B;"></i>
                        <span>跨领域图像匹配</span>
                    </div>
                </div>
            </div>
            
            <!-- 图库展示区域 -->
            <div class="gallery-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-images"></i> 图库示例
                        <span id="galleryCount">({{ gallery_images|length if gallery_images else 0 }}张)</span>
                    </h2>
                    <div class="section-actions">
                        <button class="refresh-btn" onclick="refreshGallery()" title="刷新随机图片">
                            <i class="fas fa-sync-alt"></i> 换一批
                        </button>
                    </div>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    {% if gallery_images %}
                        {% for image in gallery_images %}
                        <div class="gallery-item">
                            <img src="{{ image.url }}" 
                                 class="gallery-image" 
                                 alt="随机图片 {{ loop.index }}"
                                 onerror="handleImageError(this)"
                                 onclick="previewGalleryImage('{{ image.filename }}')">
                            <!-- 修改点: 增加更丰富的标签描述 -->
                            <div class="gallery-label">
                                <strong>图片 {{ loop.index }}</strong><br>
                                <small style="color: #9CA3AF;">点击预览大图</small>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #9CA3AF;">
                            <i class="fas fa-image" style="font-size: 48px; margin-bottom: 20px; color: #6B7280;"></i>
                            <p>暂无图片数据</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- 快速检索入口 -->
            <div class="quick-search-section">
                <div class="quick-search-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="quick-search-text">
                    <h2>开始您的图片检索之旅</h2>
                    <p>拥有了一张图片，但不知道它在哪？或者想找一张风格类似的？上传它，让我们帮您找到答案。</p>
                    <a href="/search" class="search-btn">
                        <i class="fas fa-search"></i> 立即开始检索
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 修改点: 在 script 标签内部增加更多的日志和交互说明 -->
    <script>
        // 刷新图库
        async function refreshGallery() {
            const refreshBtn = document.querySelector('.refresh-btn');
            const galleryGrid = document.getElementById('galleryGrid');
            
            if (refreshBtn && galleryGrid) {
                console.log('用户点击了“换一批”按钮，正在刷新图库...');
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 刷新中...';
                
                try {
                    const response = await fetch('/api/random_images?count=50');
                    if (!response.ok) throw new Error('获取随机图片失败');
                    
                    const data = await response.json();
                    if (data.success && data.images.length > 0) {
                        console.log(`成功获取 ${data.images.length} 张图片，正在更新页面...`);
                        galleryGrid.innerHTML = '';
                        document.getElementById('galleryCount').textContent = `(${data.images.length}张)`;
                        
                        data.images.forEach((image, index) => {
                            const galleryItem = document.createElement('div');
                            galleryItem.className = 'gallery-item';
                            galleryItem.innerHTML = `
                                <img src="${image.url}" 
                                     class="gallery-image" 
                                     alt="随机图片 ${index + 1}"
                                     onerror="handleImageError(this)"
                                     onclick="previewGalleryImage('${image.filename}')">
                                <div class="gallery-label">
                                    <strong>图片 ${index + 1}</strong><br>
                                    <small style="color: #9CA3AF;">点击预览大图</small>
                                </div>
                            `;
                            galleryGrid.appendChild(galleryItem);
                        });
                        console.log('图库更新完成。');
                    }
                } catch (error) {
                    console.error('刷新图库时出错:', error);
                    alert('刷新图库失败，请稍后重试');
                } finally {
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> 换一批';
                }
            }
        }
        
        // 预览图库图片
        function previewGalleryImage(filename) {
            console.log(`用户预览了图片: ${filename}`);
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.9); display: flex; align-items: center;
                justify-content: center; z-index: 1000; cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%;">
                    <img src="/gallery/${filename}" 
                         style="max-width: 100%; max-height: 100%; border-radius: 10px;"
                         alt="大图预览">
                    <div style="color: white; text-align: center; margin-top: 15px; font-size: 1.1rem;">
                        点击任意位置关闭预览
                    </div>
                </div>
            `;
            
            modal.onclick = () => {
                console.log('用户关闭了图片预览。');
                document.body.removeChild(modal);
            };
            document.body.appendChild(modal);
        }
        
        // 图片加载错误处理
        function handleImageError(imgElement) {
            console.warn('图片加载失败，显示占位符:', imgElement.src);
            imgElement.onerror = null;
            imgElement.src = 'https://via.placeholder.com/300x200/E5E7EB/333?text=图片加载中';
        }
    </script>
</body>
</html>